<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŸ¢ VIPCEP Customer App</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
    .container { max-width: 800px; margin: auto; }
    .header { text-align: center; padding: 20px; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .kvkk, .login, .call-management { background: #fff; padding: 20px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    button { padding: 10px 20px; background: #dc2626; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #b91c1c; }
    input, select { padding: 8px; margin: 5px 0; width: 100%; border: 1px solid #ddd; border-radius: 4px; }
    .accept { background: #16a34a; }
    .accept:hover { background: #15803d; }
    .reject { background: #6b7280; }
    .reject:hover { background: #4b5563; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <p id="connectionStatus">BaÄŸlanÄ±yor...</p>
      <select id="languageSelect">
        <option value="tr">ðŸ‡¹ðŸ‡· TR</option>
      </select>
      <h1>USTAMA SOR</h1>
      <p>Teknik Servis DanÄ±ÅŸmanlÄ±ÄŸÄ±</p>
    </div>

    <div class="kvkk">
      <h3>ðŸ“‹ KiÅŸisel Verilerin KorunmasÄ±</h3>
      <p>1. Ses kayÄ±tlarÄ± tutulmaz, bilgiler paylaÅŸÄ±lmaz.</p>
      <p>2. Kimlik bilgisi talep edilmez, anonim kullanÄ±m.</p>
      <p>3. KVKK uyarÄ±nca sadece teknik veriler geÃ§ici saklanÄ±r.</p>
      <p>4. PaylaÅŸÄ±lan bilgiler kullanÄ±cÄ±nÄ±n sorumluluÄŸundadÄ±r.</p>
      <p>5. Onaylayarak bu ÅŸartlarÄ± kabul etmiÅŸ sayÄ±lÄ±rsÄ±nÄ±z.</p>
      <button class="reject" onclick="rejectKvkk()">Reddet</button>
      <button class="accept" onclick="acceptKvkk()">OnaylÄ±yorum</button>
    </div>

    <div class="login" style="display: none;">
      <h3>GiriÅŸ</h3>
      <input type="text" id="userId" placeholder="4 Haneli ID Kodunuz">
      <input type="text" id="userName" placeholder="Ad Soyad">
      <label><input type="checkbox" id="rememberMe"> ðŸ”’ Beni HatÄ±rla</label>
      <button onclick="login()">GiriÅŸ Yap</button>
      <div>
        <h4>ðŸ’³ Kredi Talebi</h4>
        <button onclick="requestCredit()">WhatsApp ile Kredi Talep Et</button>
        <p>ðŸ“ž +90 537 479 24 03</p>
      </div>
    </div>

    <div class="call-management" style="display: none;">
      <div>
        <p>KullanÄ±cÄ±: <span id="userNameDisplay">-</span></p>
        <p>ID: <span id="userIdDisplay">-</span></p>
        <p>Kredi Bakiye: <span id="creditBalance">-</span></p>
        <p>Durum: <span id="userStatus">HazÄ±r</span></p>
      </div>
      <div id="waitingQueue" style="display: none;">
        <h3>ðŸŽ¯ SÄ±rada Bekliyor</h3>
        <p>SÄ±ranÄ±z: <span id="queuePosition">-</span></p>
        <p>Tahmini bekleme: ~3-5 dk</p>
        <button onclick="cancelCall()">AramayÄ± Ä°ptal Et</button>
      </div>
      <div id="incomingCall" style="display: none;">
        <h3>ðŸ“ž Gelen Arama</h3>
        <p>ðŸ”§ USTAM ARIYOR</p>
        <p>AramayÄ± kabul ediyor musunuz?</p>
        <button class="accept" onclick="acceptCall()">Kabul Et</button>
        <button class="reject" onclick="rejectCall()">Reddet</button>
      </div>
      <div>
        <button onclick="startCall()">UstamÄ± Ara</button>
        <button onclick="requestCredit()">WhatsApp Kredi Talebi</button>
        <button onclick="logout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
      </div>
      <div id="callConnecting" style="display: none;">
        <h3>ðŸ”— BaÄŸlanÄ±yor...</h3>
        <p>Ses baÄŸlantÄ±sÄ± kuruluyor</p>
        <button onclick="cancelCall()">Ä°ptal Et</button>
      </div>
      <div id="activeCall" style="display: none;">
        <h3>ðŸ“Š GÃ¶rÃ¼ÅŸme Aktif</h3>
        <p id="callDuration">00:00</p>
        <button onclick="endCall()">GÃ¶rÃ¼ÅŸmeyi SonlandÄ±r</button>
      </div>
    </div>

    <div class="footer">
      <p>VIPCEP Teknik Servis Â© 2025</p>
      <p>Mobil Cihaz Teknik DanÄ±ÅŸmanlÄ±ÄŸÄ±</p>
    </div>
  </div>

  <div id="callEnded" style="display: none;">
    <h3>ðŸ’³ GÃ¶rÃ¼ÅŸme Sona Erdi</h3>
    <p>GÃ¶rÃ¼ÅŸme SÃ¼resi: <span id="endCallDuration">00:00</span></p>
    <p>KullanÄ±lan Kredi: <span id="creditsUsed">0 dakika</span></p>
    <p>Kalan Krediniz: <span id="creditsRemaining">0 dakika</span></p>
    <button onclick="closeCallEnded()">âœ” Tamam</button>
  </div>

  <script>
    const ws = new WebSocket(`ws://${window.location.host}`);
    ws.onopen = () => {
      document.getElementById('connectionStatus').textContent = 'BaÄŸlandÄ±';
    };
    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type === 'login-response' && data.success) {
        document.getElementById('login').style.display = 'none';
        document.getElementById('call-management').style.display = 'block';
        document.getElementById('userNameDisplay').textContent = data.user.name;
        document.getElementById('userIdDisplay').textContent = data.user.id;
        document.getElementById('creditBalance').textContent = data.credits;
      }
    };

    function acceptKvkk() {
      ws.send(JSON.stringify({ type: 'kvkk-consent', consent: true }));
      document.getElementById('kvkk').style.display = 'none';
      document.getElementById('login').style.display = 'block';
    }

    function rejectKvkk() { window.location.href = '/'; }

    function login() {
      const id = document.getElementById('userId').value;
      const name = document.getElementById('userName').value;
      const remember = document.getElementById('rememberMe').checked;
      ws.send(JSON.stringify({ type: 'register', id, name, userType: 'customer' }));
    }

    function startCall() { ws.send(JSON.stringify({ type: 'call-request' })); }
    function cancelCall() { ws.send(JSON.stringify({ type: 'call-cancelled' })); }
    function acceptCall() { ws.send(JSON.stringify({ type: 'accept-call' })); }
    function rejectCall() { ws.send(JSON.stringify({ type: 'reject-call' })); }
    function endCall() { ws.send(JSON.stringify({ type: 'end-call' })); }
    function requestCredit() { window.open('https://wa.me/+905374792403'); }
    function logout() { window.location.href = '/logout'; }
    function closeCallEnded() { document.getElementById('callEnded').style.display = 'none'; }
  </script>
</body>
</html>
